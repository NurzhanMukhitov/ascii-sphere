<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <!-- viewport-fit=cover позволяет использовать safe area -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>3D Animated Sphere</title>
  <style>
    /* Сброс стилей */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    html, body {
      width: 100%;
      height: 100%;
    }
    body {
      font-family: monospace;
      background: black;
      color: white;
      overflow: hidden;
    }

    /* Основной контейнер — flex, чтобы распределить информационный блок и canvas */
    .container {
      display: flex;
      flex-direction: row;
      height: 100vh;
      width: 100vw;
    }

    /* Информационный блок (левая колонка) */
    .info-container {
      flex: 0 0 300px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 20px;
      overflow-y: auto;
    }
    .info-block h2 {
      font-size: 20px;
      text-transform: uppercase;
      margin-bottom: 10px;
    }
    .info-block p {
      font-size: 16px;
      line-height: 1.5;
    }
    .info-block a {
      color: white;
      text-decoration: underline;
    }

    /* Языковой переключатель — размещаем его в правом верхнем углу страницы */
    .lang-switcher {
      position: absolute;
      top: env(safe-area-inset-top, 10px);
      right: 20px;
      display: flex;
      gap: 10px;
    }
    .lang-switcher button {
      background: transparent;
      border: 1px solid white;
      color: white;
      padding: 5px 10px;
      cursor: pointer;
      transition: background 0.3s, color 0.3s;
    }
    .lang-switcher button:hover {
      background: white;
      color: black;
    }

    /* Контейнер для canvas — занимает оставшееся пространство */
    .canvas-container {
      flex: 1 1 auto;
      position: relative;
    }
    .canvas-container canvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    /* Медиазапрос для узких экранов: переключение на колонку */
    @media (max-width: 600px) {
      .container {
        flex-direction: column;
      }
      .info-container {
        flex: 0 0 auto;
        width: 100%;
        max-height: 200px;
      }
    }

    /* Медиазапрос по высоте: корректировка отступов и размеров шрифтов */
    @media (max-height: 450px) {
      .info-container {
        padding: 10px;
      }
      .info-block h2 {
        font-size: 18px;
      }
      .info-block p {
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <!-- Языковой переключатель (RU/ENG) -->
  <div class="lang-switcher">
    <button id="btn-ru">RU</button>
    <button id="btn-eng">ENG</button>
  </div>
  
  <!-- Основной контейнер -->
  <div class="container">
    <!-- Информационный блок (левая колонка) -->
    <div class="info-container">
      <!-- Русская версия -->
      <div class="info-block ru">
        <h2>Что это</h2>
        <p>
          Это псевдографическая симуляция, где каждый символ означает 3D-точку.
          Код написан Chat GPT. Симуляция интерактивная и с ней можно взаимодействовать.
        </p>
      </div>
      <div class="info-block ru">
        <h2>Сделано</h2>
        <p>
          <a href="https://www.instagram.com/nmk_one/" target="_blank">Instagram</a>
        </p>
      </div>
      <!-- Английская версия -->
      <div class="info-block eng">
        <h2>What is it</h2>
        <p>
          This is a pseudographics simulation where each character represents a 3D point.
          Code written by Chat GPT. The simulation is interactive and can be controlled.
        </p>
      </div>
      <div class="info-block eng">
        <h2>Made by</h2>
        <p>
          <a href="https://www.instagram.com/nmk_one/" target="_blank">Instagram</a>
        </p>
      </div>
    </div>

    <!-- Контейнер для canvas -->
    <div class="canvas-container">
      <canvas id="canvas"></canvas>
    </div>
  </div>

  <script>
    // Переключатель языков
    const btnRU = document.getElementById('btn-ru');
    const btnENG = document.getElementById('btn-eng');
    function showRU() {
      document.querySelectorAll('.ru').forEach(el => el.style.display = 'block');
      document.querySelectorAll('.eng').forEach(el => el.style.display = 'none');
    }
    function showENG() {
      document.querySelectorAll('.ru').forEach(el => el.style.display = 'none');
      document.querySelectorAll('.eng').forEach(el => el.style.display = 'block');
    }
    btnRU.addEventListener('click', showRU);
    btnENG.addEventListener('click', showENG);
    // По умолчанию показываем русский
    showRU();

    // Настройка canvas: подстраиваем размеры под контейнер
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    function resizeCanvas() {
      const container = document.querySelector('.canvas-container');
      canvas.width = container.clientWidth;
      canvas.height = container.clientHeight;
    }
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    // ASCII-сфера
    const numPoints = 1000;
    let radius = 200;
    // Корректируем радиус, если экран маленький
    if(window.innerWidth < 600 || window.innerHeight < 450){
      radius = 100;
    }
    const zOffset = 400;
    const points = [];
    for(let i = 0; i < numPoints; i++){
      const theta = Math.acos(2 * Math.random() - 1);
      const phi = 2 * Math.PI * Math.random();
      const x = radius * Math.sin(theta) * Math.cos(phi);
      const y = radius * Math.sin(theta) * Math.sin(phi);
      const z = radius * Math.cos(theta) + zOffset;
      const char = Math.floor(Math.random() * 10);
      points.push({ x, y, z, char });
    }

    let rotationX = 0;
    let rotationY = 0;
    let rotationZ = 0;
    let isDragging = false;
    let lastMouseX = 0;
    let lastMouseY = 0;

    canvas.addEventListener('mousedown', e => {
      isDragging = true;
      lastMouseX = e.clientX;
      lastMouseY = e.clientY;
    });
    canvas.addEventListener('mousemove', e => {
      if (!isDragging) return;
      const dx = e.clientX - lastMouseX;
      const dy = e.clientY - lastMouseY;
      rotationY += dx * 0.01;
      rotationX += dy * 0.01;
      lastMouseX = e.clientX;
      lastMouseY = e.clientY;
    });
    canvas.addEventListener('mouseup', () => { isDragging = false; });
    canvas.addEventListener('mouseleave', () => { isDragging = false; });

    function rotate(point, angleX, angleY, angleZ) {
      let { x, y, z } = point;
      let cos = Math.cos(angleX), sin = Math.sin(angleX);
      let y1 = y * cos - z * sin;
      let z1 = y * sin + z * cos;
      y = y1; z = z1;
      cos = Math.cos(angleY); sin = Math.sin(angleY);
      let x1 = x * cos + z * sin;
      let z2 = -x * sin + z * cos;
      x = x1; z = z2;
      cos = Math.cos(angleZ); sin = Math.sin(angleZ);
      let x2 = x * cos - y * sin;
      let y2 = x * sin + y * cos;
      x = x2; y = y2;
      return { x, y, z, char: point.char };
    }

    function project(point) {
      const focalLength = 500;
      const scale = focalLength / (focalLength + point.z);
      return {
        x: point.x * scale + canvas.width / 2,
        y: point.y * scale + canvas.height / 2
      };
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      for (const p of points) {
        const rotated = rotate(p, rotationX, rotationY, rotationZ);
        const proj = project(rotated);
        const brightnessFactor = 1 - ((rotated.z - (zOffset - radius)) / (2 * radius));
        const shade = Math.floor(128 + brightnessFactor * 127);
        ctx.fillStyle = `rgb(${shade},${shade},${shade})`;
        ctx.font = "16px monospace";
        ctx.fillText(p.char, proj.x, proj.y);
      }
      // Автовращение — хаотичные приращения
      rotationX += 0.005;
      rotationY += 0.01;
      rotationZ += 0.003;
      requestAnimationFrame(draw);
    }
    draw();
  </script>
</body>
</html>
